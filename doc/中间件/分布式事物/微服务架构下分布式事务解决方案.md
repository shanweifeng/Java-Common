## [微服务架构下分布式事务解决方案](https://www.cnblogs.com/jiangyu666/p/8522547.html)

* 微服务开发框架
```text
Dubbo springCloud thrift grpc等
```

* 微服务落地存在的问题
```text
1、单体应用拆分为分布式系统后，进程间的通讯机制和故障处理措施变得更加复杂。
2、系统微服务化后，一个看似简单的功能，内部可能需要调用多个服务并操作多个数据库实现，服务调用的分布式事务问题变得非常突出
3、微服务数量众多，测试、部署、监控等都变得更加困难
对于第一个问题 各个微服务开发框架现在已经支持多协议 restful调用；第三个问题部署监控等已经有docker devops等技术。分布式事物是一个相对复杂的处理。

```

#### SOA分布式事务解决方案
* 基于XA协议的两阶段(三阶段)提交方案
```text
交易中间件与数据库通过XA接口规范，使用两阶段提交来完成一个全局事务，XA规范的基础是两阶段提交协议。
第一阶段是表决阶段,所有参与者都将本事务能否成功的信息反馈发给协调者；第二阶段是执行阶段，协调者根据所有参与者的反馈，通知所有参与者，步调一致地在所有分支上提交或者回滚。
现有的几乎所有商业OLTP数据库都支持XA协议。但是两阶段方案锁定资源时间长，对性能影响很大，基本不适合解决微服务事务问题。而且如果两阶段提交在第二阶段执行阶段如果出问题，则会发生不可逆的错误。

```

* TCC方案
```text
TCC 方案在电商、金融领域落地较多。TCC方案其实是两阶段提交的一种改进。其整个业务逻辑的每个分支显示的分成了Try、Confirm、Cancel三个操作。分别完成准备工作、业务提交、事务回滚。
执行方式：事务开始时，业务应用会向事务协调器注册启动事务，之后进行try confirm cancel操作。如果接口调用失败会进行重试。 
TCC方案让应用自己定义数据库操作粒度，使得降低所冲突，提高吞吐量称为可能。但是TCC方案对业务侵入性强，业务逻辑的每个分支都需要实现try confirm cancel三个操作，改造成本高。且confirm cancel操作必须实现幂等，实现难度较大。

```

* 基于消息最终一致性方案
```text
通过消息中间件保证上下游应用数据操作的一致性。基本思路是将本地操作和发送消息放在一个事务中，保证本地操作和消息发送要么两者都成功或者都失败。下游应用向消息系统订阅该消息，收到消息后执行相应操作。
本质上讲试讲分布式事务转换为两个本第事务，然后依靠下游业务的重试机制达到最终一致性。基于消息的最终一致性方案改造成本也是比较搞的，而且也不能确保重试一定成功。
```

* 阿里GTS分布式事务
```text

```